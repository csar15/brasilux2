package {	import fl.containers.ScrollPane;		import flash.display.Bitmap;	import flash.display.BitmapData;	import flash.display.BlendMode;	import flash.display.DisplayObject;	import flash.display.Loader;	import flash.display.MovieClip;	import flash.display.Sprite;	import flash.display.StageDisplayState;	import flash.display.StageScaleMode;	import flash.display.StageAlign	import flash.events.Event;	import flash.events.MouseEvent;	import flash.filters.ColorMatrixFilter;	import flash.filters.GlowFilter;	import flash.geom.ColorTransform;	import flash.net.FileFilter;	import flash.net.FileReference;	import flash.net.URLRequest;	import flash.net.navigateToURL;	import flash.text.TextField;	import flash.text.TextFormat;	[SWF(width="1024", height="768", frameRate="45", backgroundColor="#E2E2E2")]	public class Main extends Sprite {		//private var browser_and_save:BrowseAndSave = new BrowseAndSave()				public var i:Number=0;		public var MAX_WIDTH:Number = stage.stageWidth		public var MAX_HEIGHT:Number = stage.stageHeight		private var matrix:Array;		private var myColorMatrix_filter:ColorMatrixFilter;		private var topo:Topo = new Topo()		public var menufooter:MenuFooter = new MenuFooter()		public var menutools:MenuFerramentas = new MenuFerramentas()		public var menuweather:MenuTemperatura = new MenuTemperatura()		private var footer:Footer = new Footer()		private var btfullscreen:BtFullScreen = new BtFullScreen()		public var scrollpane:ScrollPane = new ScrollPane();		public var menupalheta:MenuPalheta = new MenuPalheta()		public var captiontab:CaptionTab = new CaptionTab()		public var container:MovieClip		public var foto:MovieClip		public var foto_multi:MovieClip		public var form_cor:MovieClip		public var form_masc:MovieClip				private var toolhelp:ToolHelp = new ToolHelp()		private var help:Help = new Help()		private var galerydiff:GaleryDiff		private var galery:Galery = new Galery()		private var saveimg:SaveImg = new SaveImg()		private var printcontainer:PrintImg = new PrintImg()		private var fileRef:FileReference = new FileReference();		private var loader:Loader = new Loader()				public var masc:Mascara;		public var masc_cor:MovieClip		public var masc_color:MovieClip		public var masc_select:MovieClip				public var img_select:MovieClip		public var multi_select:MovieClip				private var imageDataOld:BitmapData		private var imageOld:Bitmap		public function Main() {			Init()		}		public function Init():void {			trace("hello world 52");						stage.scaleMode = StageScaleMode.NO_SCALE			//stage.align = StageAlign.TOP			//stage.addEventListener( Event.RESIZE, StageResize );			StageResize()			MatrixFilter();			//			CreatLayers()			//			CreatInterface();			CreatTools();			CreatPalheta()			FirstView()			CreatCaption()		}		private function StageResize(event:Event=null):void {			MAX_WIDTH = stage.stageWidth			MAX_HEIGHT = stage.stageHeight		}		private function MatrixFilter():void {			matrix = new Array();			matrix=matrix.concat([0,1,0,0,0]);			matrix=matrix.concat([0,1,0,0,0]);			matrix=matrix.concat([0,1,0,0,0]);			matrix=matrix.concat([0,0,0,1,0]);			myColorMatrix_filter=new ColorMatrixFilter(matrix);		}		private function FirstView():void {			help.main = this			help.Init()		}		private function CreatLayers():void {			Container()			Foto()			CreatCor()			CreatMultiply()			CreatMasc()		}		private function RemoveLayers():void {			//foto_multi.mask = null			for (var k:Number = 0; k<foto.numChildren; k++) {				foto.removeChildAt(k)			}			for (var u:Number = 0; u<foto_multi.numChildren; u++) {				foto_multi.removeChildAt(u)			}			for (var w:Number = 0; w<form_cor.numChildren; w++) {				form_cor.removeChildAt(w)				}			for(var j:Number = 0; j<form_masc.numChildren; j++) {				form_masc.removeChildAt(j)			}			container.removeChild(foto)			container.removeChild(form_cor)			container.removeChild(foto_multi)			container.removeChild(form_masc)			removeChild(container)					}		public function Reset():void {			if(foto.numChildren>0) {				RemoveLayers()				CreatLayers()				i = 0 			}		}		private function CreatInterface():void {			addChild(topo)						footer.y = MAX_HEIGHT - footer.height			footer.bt_chilli.addEventListener(MouseEvent.CLICK, PressGoDev)			addChild(footer)						menufooter.y = MAX_HEIGHT - footer.height - menufooter.height			addChild(menufooter)						menufooter.btupload.buttonMode = true			menufooter.btupload.addEventListener(MouseEvent.CLICK, PressBrowser);			menufooter.btupload.addEventListener(MouseEvent.MOUSE_OVER, OverMenu)			menufooter.btupload.addEventListener(MouseEvent.MOUSE_OUT, OutMenu)						menufooter.btsave.buttonMode = true			menufooter.btsave.addEventListener(MouseEvent.MOUSE_OVER, OverMenu)			menufooter.btsave.addEventListener(MouseEvent.MOUSE_OUT, OutMenu)						menufooter.btdiff.buttonMode = true			menufooter.btdiff.addEventListener(MouseEvent.MOUSE_OVER, OverMenu)			menufooter.btdiff.addEventListener(MouseEvent.CLICK, PressDiff)			menufooter.btdiff.addEventListener(MouseEvent.MOUSE_OUT, OutMenu)						menufooter.btgalery.buttonMode = true			menufooter.btgalery.addEventListener(MouseEvent.CLICK, PressGalery);			menufooter.btgalery.addEventListener(MouseEvent.MOUSE_OVER, OverMenu)			menufooter.btgalery.addEventListener(MouseEvent.MOUSE_OUT, OutMenu)						menufooter.bthelp.buttonMode = true			menufooter.bthelp.addEventListener(MouseEvent.CLICK, PressHelp)			menufooter.bthelp.addEventListener(MouseEvent.MOUSE_OVER, OverMenu)			menufooter.bthelp.addEventListener(MouseEvent.MOUSE_OUT, OutMenu)						menufooter.btprint.buttonMode = true			menufooter.btprint.addEventListener(MouseEvent.MOUSE_OVER, OverMenu)			menufooter.btprint.addEventListener(MouseEvent.CLICK, PressPrint)			menufooter.btprint.addEventListener(MouseEvent.MOUSE_OUT, OutMenu)						btfullscreen.addEventListener(MouseEvent.CLICK, FullScreen)			btfullscreen.buttonMode = true			btfullscreen.x = topo.width - btfullscreen.width -5			btfullscreen.y = 5			topo.addChild(btfullscreen)					}		private function Container():void {			container = new MovieClip()			container.x = 0			container.y = topo.height			addChildAt(container, 0)			//			var masc_container:MovieClip = new MovieClip()			masc_container.graphics.beginFill(0x000000, 1)			masc_container.graphics.drawRect(0, 0, this.MAX_WIDTH, this.MAX_HEIGHT)			masc_container.y = 0			masc_container.x = 0			addChildAt(masc_container, 0)			container.mask = masc_container		}		private function Foto():void {			foto = new MovieClip()			container.addChildAt(foto, 0);			foto.addEventListener(MouseEvent.CLICK, UnSelectForm)		}		public function CreatCor():void {			form_cor = new MovieClip()			container.addChildAt(form_cor, 1)		}		public function CreatMultiply():void {			foto_multi = new MovieClip()			foto_multi.name="multi"+i;			foto_multi.blendMode=BlendMode.MULTIPLY			foto_multi.alpha = 0.8			foto_multi.filters=[myColorMatrix_filter];			//foto_multi.visible = false			container.addChildAt(foto_multi, 2);			}		public function CreatMasc():void {			form_masc = new MovieClip()			container.addChildAt(form_masc, 3)				}		public function CreatInfo():void {			var logobrasilux:LogoBrasilux = new LogoBrasilux()			logobrasilux.x = 0			logobrasilux.y = MAX_HEIGHT - logobrasilux.height			container.addChild(logobrasilux)			var info:TextField = new TextField()						info.width = 725			info.height = 110			info.x = 260			info.y = 45						var textformat:TextFormat = new TextFormat()			//textformat.color = 0x000000			textformat.size = 16			textformat.font = "Arial"			textformat.leading = 14			info.defaultTextFormat = textformat;									for (var j:Number=0; j<=form_masc.numChildren; j++) {				var form_info:DisplayObject = form_masc.getChildByName("mascara"+j)				if (form_info != null) {					if (form_info.colorcod != null) {						//trace(form_info.hexacolor)						//info.textColor = "0x"+ form_info.hexacolor 						//info.text = info.text + "██ Pintura" + j + "_cód.cor:" + form_info.colorcod	+ "     "						info.htmlText = info.htmlText + "<font color='#" + form_info.hexacolor + "'>██</font>" + " Pintura" + j + "_cód.cor:" + form_info.colorcod + "     "					}				}			}			info.selectable = false			info.multiline = true			info.wordWrap = true			info.condenseWhite = true						//info.text = "hvpiuv  iu iou iou iou oiu oiiu oiu iou oiu oiu iou u iou iou piuvpiuviuvoiuvoi"						logobrasilux.addChild(info)								}		private function CreatTools():void {			menutools.x = 5			menutools.y = MAX_HEIGHT/2 + 10			addChild(menutools)						menutools.btform.buttonMode = true			menutools.btdel.buttonMode = true			menutools.btselect.buttonMode = true			menutools.bthelp.buttonMode = true			menutools.bthelp.addEventListener(MouseEvent.CLICK, PressToolHelp)			menutools.btdel.addEventListener(MouseEvent.CLICK, PressDel);			//			menuweather.x = 5			menuweather.y = MAX_HEIGHT/2 + 5 - menuweather.height - 30			addChild(menuweather)						menuweather.btday.buttonMode = true			menuweather.btday.addEventListener(MouseEvent.CLICK, BlendDay)			menuweather.btfire.buttonMode = true			menuweather.btfire.addEventListener(MouseEvent.CLICK, BlendFire)			menuweather.btnigth.buttonMode = true			menuweather.btnigth.addEventListener(MouseEvent.CLICK, BlendNigth)				}		private function CreatPalheta():void {			menupalheta.main = this			scrollpane.move(MAX_WIDTH - 150,topo.height+20);			scrollpane.setSize(150,300);			scrollpane.scrollDrag = true;					scrollpane.source = menupalheta			addChildAt(scrollpane, 7);			this.addEventListener(Event.ENTER_FRAME, ResizeScrollPane) 		}		public function ResizeScrollPane(e:Event):void {			scrollpane.update()		}		private function CreatCaption():void {			addChildAt(captiontab, 9)		}		private function BlendDay(e:MouseEvent):void {			if (img_select != null) {				ToolON(menuweather.btday)				ToolOFF(menuweather.btfire)				ToolOFF(menuweather.btnigth)				var day:DisplayObject = img_select.getChildByName("day")				var fire:DisplayObject = img_select.getChildByName("fire")				var nigth:DisplayObject = img_select.getChildByName("nigth")				day.visible = true				fire.visible = false				nigth.visible = false				//				var multiday:DisplayObject = multi_select.getChildByName("day")				var multifire:DisplayObject = multi_select.getChildByName("fire")				var multinigth:DisplayObject = multi_select.getChildByName("nigth")				multiday.visible = true				multifire.visible = false				multinigth.visible = false			}		}		private function BlendFire(e:MouseEvent):void {			if (img_select != null) {				ToolOFF(menuweather.btday)				ToolON(menuweather.btfire)				ToolOFF(menuweather.btnigth)				var day:DisplayObject = img_select.getChildByName("day")				var fire:DisplayObject = img_select.getChildByName("fire")				var nigth:DisplayObject = img_select.getChildByName("nigth")				day.visible = false				fire.visible = true				nigth.visible = false				//				var multiday:DisplayObject = multi_select.getChildByName("day")				var multifire:DisplayObject = multi_select.getChildByName("fire")				var multinigth:DisplayObject = multi_select.getChildByName("nigth")				multiday.visible = false				multifire.visible = true				multinigth.visible = false			}		}		private function BlendNigth(e:MouseEvent):void {			if (img_select != null) {				ToolOFF(menuweather.btday)				ToolOFF(menuweather.btfire)				ToolON(menuweather.btnigth)				var day:DisplayObject = img_select.getChildByName("day")				var fire:DisplayObject = img_select.getChildByName("fire")				var nigth:DisplayObject = img_select.getChildByName("nigth")				day.visible = false				fire.visible = false				nigth.visible = true				//				var multiday:DisplayObject = multi_select.getChildByName("day")				var multifire:DisplayObject = multi_select.getChildByName("fire")				var multinigth:DisplayObject = multi_select.getChildByName("nigth")				multiday.visible = false				multifire.visible = false				multinigth.visible = true			}		}		public function ToolON(mc:MovieClip):void {			var glowOverOutter:GlowFilter = new GlowFilter(0xffcc00,1, 16, 16, 1.4, 1, false, false)			mc.filters = [glowOverOutter]		}		public function ToolOFF(mc:MovieClip):void {			mc.filters = null		}		public function OverMenu(e:MouseEvent):void {			var glowOverInner:GlowFilter = new GlowFilter(0xffffff,1, 14, 14, 1.8, 1, true, false)			var glowOverOutter:GlowFilter = new GlowFilter(0xffcc00,1, 16, 16, 1.4, 1, false, false)			e.currentTarget.filters = [glowOverInner, glowOverOutter]		}		public function OutMenu(e:MouseEvent):void {			e.currentTarget.filters = null		}		public function FullScreen(e:MouseEvent = null):void {			if ( stage.hasOwnProperty("displayState") ) {				if ( stage.displayState != StageDisplayState.FULL_SCREEN ) {					stage.displayState = StageDisplayState.FULL_SCREEN;				} else {					stage.displayState = StageDisplayState.NORMAL;									}			}		}		public function ChangeAlign():void {			if (stage.align != StageAlign.TOP_LEFT) {				stage.align = StageAlign.TOP_LEFT			} else {				stage.align = ""			}		}		private function PressGoDev(e:MouseEvent):void {			var url:String= "http://www.chilli360.com.br/"			var targetURL:URLRequest = new URLRequest(url);    		navigateToURL(targetURL, "_blank");		}		private function PressToolHelp(e:MouseEvent):void {			toolhelp.main = this			toolhelp.Init()		}		private function PressHelp(e:MouseEvent):void {			help.main = this			help.Init()		}		private function PressDiff(e:MouseEvent):void {			if (foto.numChildren>0) {				//this.ChangeAlign()				stage.displayState = StageDisplayState.NORMAL;				galerydiff = new GaleryDiff(imageOld, container)				galerydiff.main = this				galerydiff.x = this.MAX_WIDTH/2 - galerydiff.width/2				galerydiff.y = this.MAX_HEIGHT/2 - galerydiff.height/2				addChild(galerydiff)				this.swapChildren(captiontab, galerydiff)							}		}		public function DiffOld():void {			var W:Number = 1024			var H:Number = 555			imageDataOld = new BitmapData(W, H)			imageDataOld.draw(container)			imageOld = new Bitmap(imageDataOld)		}		private function PressSave(e:MouseEvent):void {			stage.displayState = StageDisplayState.NORMAL;			CreatInfo()			saveimg.Save(MAX_WIDTH, MAX_HEIGHT, container)		}		private function PressPrint(e:MouseEvent):void {			if (foto.numChildren>0) {				//stage.displayState = StageDisplayState.NORMAL;				CreatInfo()				printcontainer.main = this				printcontainer.printPage(stage.stageWidth, stage.stageHeight + 200, container)			}		}		public function PressGalery(e:MouseEvent):void {			Reset()			galery.main = this			galery.init()			menufooter.btsave.addEventListener(MouseEvent.CLICK, PressSave);			menutools.btform.addEventListener(MouseEvent.CLICK, PressCreat);			//			menufooter.btupload.removeEventListener(MouseEvent.CLICK, PressBrowser)			menufooter.btgalery.removeEventListener(MouseEvent.CLICK, PressGalery)		}		public function PressBrowser(e:MouseEvent):void {			Reset()			fileRef.browse([new FileFilter("Images", "*.jpg;*.gif;*.png")]);			fileRef.addEventListener(Event.SELECT, onFileSelected);			//			//menufooter.btupload.removeEventListener(MouseEvent.CLICK, PressBrowser)			//menufooter.btgalery.removeEventListener(MouseEvent.CLICK, PressGalery)		}		private function onFileSelected(e:Event):void {			fileRef.load();			fileRef.addEventListener(Event.COMPLETE, onDataLoaded);			//		}		private function onDataLoaded(e:Event):void {			menufooter.btsave.addEventListener(MouseEvent.CLICK, PressSave);			menutools.btform.addEventListener(MouseEvent.CLICK, PressCreat);			//			loader.contentLoaderInfo.addEventListener(Event.COMPLETE, onResize);			loader.loadBytes(fileRef.data);			foto.addChild(loader)			LoadMultiply()						}						private function onResize(e:Event):void {			//if (e.target.content.width>MAX_WIDTH || e.target.content.height>MAX_HEIGHT) {				resizeBitmap(e.target.content);			//}		}				private function resizeBitmap(target:DisplayObject):void {			if (target.height>target.width) {				target.width=MAX_WIDTH;				target.scaleY=target.scaleX;			} else if ( target.width >= target.height ) {				target.height=MAX_HEIGHT;				target.scaleX=target.scaleY;			}			DiffOld()		}		private function PressCreat(e:MouseEvent):void {			creatForm();			ToolON(menutools.btform)			ToolOFF(menutools.btselect)		}				private function PressDel(e:MouseEvent):void {			if (masc_select != null) {				if (form_masc.numChildren > 0) {					form_masc.removeChild(masc_select);									var cor_id:Number = masc_select.id					var form:DisplayObject = form_cor.getChildByName("cor"+cor_id)					var form_color:DisplayObject = form_cor.getChildByName("cor_select"+cor_id)									form_cor.removeChild(form)					form_cor.removeChild(form_color)					ToolOFF(menutools.btform)					masc_select = null				}			}		}		public function Diff(mc:MovieClip):void {			var diffcor:DisplayObject = mc.getChildAt(1)			var diffmulti:DisplayObject = mc.getChildAt(2)			var diffmasc:DisplayObject = mc.getChildAt(3)			if (diffcor.visible != false) {				diffcor.visible = false				diffmulti.visible = false				diffmasc.visible = false			} else {				diffcor.visible = true				diffmulti.visible = true				diffmasc.visible = true				}		}		public function LoadMultiply():void {			var canvas_loader:Loader = new Loader();			canvas_loader.loadBytes(fileRef.data);			canvas_loader.contentLoaderInfo.addEventListener(Event.COMPLETE, onResize);			foto_multi.addChild(canvas_loader);			foto_multi.visible = false		}		public function creatForm():void {			//masc.makeForm();			masc = new Mascara(MAX_WIDTH, MAX_HEIGHT);			masc.main=this;			masc.name="mascara"+i;			masc.id = i			form_masc.addChild(masc);			masc_select = masc			foto_multi.mask=null			foto_multi.visible = false			//menutools.btdel.addEventListener(MouseEvent.CLICK, PressDel);		}		public function EndForm():void {					ToolON(menutools.btselect)			ToolOFF(menutools.btform)			ColorForm(masc, 0xffFFff)			foto_multi.mask=form_masc;			foto_multi.visible = true			masc.addEventListener(MouseEvent.CLICK, MascPress)			masc.addEventListener(MouseEvent.MOUSE_OVER, MascOver)			masc.addEventListener(MouseEvent.MOUSE_OUT, MascOut)			masc.buttonMode = true			i++;					}			private function ColorForm(masc_selected:MovieClip, cor:Number):void {		 	masc_cor = new MovieClip();			masc_cor.name = "cor"+i			masc_color = new MovieClip()			masc_color.name = "cor_select"+i			var n:Number=0;			//			masc_color.graphics.beginFill(cor);			masc_cor.graphics.beginFill(cor);			//masc_color.graphics.lineStyle(3, 0x000000, 1, false, normal, 3			masc_color.graphics.moveTo(masc_selected.positions[n].x,masc_selected.positions[n].y);			masc_cor.graphics.moveTo(masc_selected.positions[n].x,masc_selected.positions[n].y);			for (var w:Number=1; w<masc_selected.positions.length; w++) {				n++;				masc_color.graphics.lineTo(masc_selected.positions[n].x,masc_selected.positions[n].y);				masc_cor.graphics.lineTo(masc_selected.positions[n].x,masc_selected.positions[n].y);			}			masc_color.graphics.endFill();			masc_cor.graphics.endFill();			//			form_cor.addChild(masc_color)			form_cor.addChild(masc_cor)		}			public function MascPress(e:MouseEvent):void {			if (e.currentTarget.colorcod != null) {				captiontab.setTxt("cód:" + e.currentTarget.colorcod + "<br>" + e.currentTarget.colorname)			}			masc_select = e.currentTarget as MovieClip;			SelectForm(masc_select)					};		private function MascColorOver(e:MouseEvent):void {			if (e.currentTarget.colorcod != null) {				captiontab.setTxt("cód:" + e.currentTarget.colorcod + "<br>" + e.currentTarget.colorname)			}		}		private function MascColorOut(e:MouseEvent):void {			captiontab.setTxt()			}		public function MascOver(e:MouseEvent):void {			var overON:GlowFilter = new GlowFilter(0xFFcc00, 0.7, 25, 25, 0.5, 1, true)			var id:Number = e.currentTarget.id			var form:DisplayObject = form_cor.getChildByName("cor"+id)			form.filters = [overON]		}		public function MascOut(e:MouseEvent):void {			var id:Number = e.currentTarget.id			var form:DisplayObject = form_cor.getChildByName("cor"+id)			form.filters = null		}		private function UnSelectForm(e:MouseEvent = null):void {			for (var w:Number=0; w<form_masc.numChildren; w++) {				var masc_remove:DisplayObject = form_masc.getChildAt(w)				masc_remove.removeEventListener(MouseEvent.MOUSE_OVER, MascColorOver)				masc_remove.removeEventListener(MouseEvent.MOUSE_OUT, MascColorOut)			}			//			for (var j:Number=0; j<form_cor.numChildren; j++) {				var form_del:DisplayObject = form_cor.getChildByName("cor_select"+j)				if (form_del != null) {					form_del.filters = []				}			}			masc_select = null		}		public function SelectForm(masc_selected:MovieClip):void {			UnSelectForm()			masc_selected.addEventListener(MouseEvent.MOUSE_OVER, MascColorOver)			masc_selected.addEventListener(MouseEvent.MOUSE_OUT, MascColorOut)			masc_select = masc_selected			var borderON:GlowFilter = new GlowFilter(0x000000, 0.6 , 6, 6, 1.8, 1)			var id:Number = masc_selected.id			var form:DisplayObject = form_cor.getChildByName("cor_select"+id)						form.filters = [borderON]		}		public function ChangeColor(masc_selected:MovieClip, num_color:Number, name_color:String, cod_color:String, hexa_color:String):void {			if(masc_selected != null) {				masc_selected.colorname = name_color				masc_selected.colorcod = cod_color				masc_selected.hexacolor = hexa_color				var id:Number = masc_selected.id				var form:DisplayObject = form_cor.getChildByName("cor"+id)							var colorTransform:ColorTransform = form.transform.colorTransform;				colorTransform.color = num_color;				form.transform.colorTransform = colorTransform;			}		}	}}